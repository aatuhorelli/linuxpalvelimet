# H5 - Nimittäin

## x) Tiivistelmät
### New Default Website with Apache 2 - Show your homepage at top of example.com, no tilde
   - Asenna Apache2
     - ````
       $ sudo apt-get update
       $ sudo apt-get -y install apache2
       ````
  - Apache voi pyörittää useita virtuaalipalvelimia samanaikaisesti
    - Virtuaalipalvelimet määritellään jokainen omassa tekstitiedostossaan polussa /etc/apache2/sites-available/
      - Virtuaalipalvelimen luonti:
        - ````sudoedit /etc/apache2/sites-available/sivu.conf````
        - ````
          ## /etc/apache2/sites-enabled/sivu.conf
          <VirtualHost: *:80>
           DocumentRoot /home/sivu/public_html/ # HTML-tiedostojen kansion polku
           <Directory /home/sivu/public_html/>
             Require all granted # Sallii Apachelle tiedostojen jaon. 403 Forbidden ilman tätä.
           </Directory>
          </VirtualHost>
          ````
    - Käytössä olevat virtuaalipalvelimet määritellään polusta /etc/apache2/sites-enabled/
      - Käyttöönotto ````sudo a2ensite sivu.conf```` ja käytöstä poistaminen ````sudo a2dissite sivu.conf````
    - Jos .conf-tiedostossa määriteltyä polkua ei löydy tai siellä ei ole index.html-nimistä tiedostoa, palvelin palauttaa virheen clientille
      - Luo polku ja index.html-tiedosto ja testaa toiminta selaimella
    - Poista vakiosivu käytöstä ja ota sivu.conf-käyttöön: ````sudo a2ensite sivu.conf | sudo a2dissite 000-default.conf````
    - Käynnistä Apache uudelleen: ````sudo service apache2 restart````

   
Lähde: Tero Karvinen - New Default Website with Apache2 – Show your homepage at top of example.com, no tilde. Luettavissa: https://terokarvinen.com/2016/02/16/new-default-website-with-apache2-show-your-homepage-at-top-of-example-com-no-tilde/

### Name Based Virtual Hosts on Apache – Multiple Websites to Single IP Address
 - Pitkälti samoja asioita kuin edellisessä artikkelissa
 - Lisäksi:
   - Nimipalvelua voi simuloida lisäämällä rivejä tiedostoon ````sudoedit /etc/hosts````
  
     
Lähde: Tero Karvinen - Name Based Virtual Hosts on Apache - Multiple Websited to Single IP Address. Luettavissa: https://terokarvinen.com/2018/04/10/name-based-virtual-hosts-on-apache-multiple-websites-to-single-ip-address/

### Name-based Virtual Host Support
 - IP-pohjaiset virtuaalipalvelimet vaativat erilliset ip-osoitteet eri palvelimille
 - Nimipohjaisissa virtuaalipalvelimissa asiakas lähettää HTTP headerissa hostnamen ja palvelin ohjaa käyttäjän oikealle sivulle. Tällöin eri hostit voivat jakaa saman ip-osoitteen.
   - Vähentää jo valmiiksi vähäisten ip-osoitteiden tarvetta
   - Nimipalveluun määritellään mihin ip-osoitteeseen eri hostnamet osoittavat, ja Apache ohjaa käyttäjät oikeille sivuille
     - VirtualHost-blokkiin on määritettävä vähintään ServerName ja DocumentRoot
     - Apache etsii ensin parhaiten pyyntöä vastaavia VirtualHost-argumentteja. Jos osumia on useampia, vertaillaan myös ServerName ja ServerAliasta.
     - Jos ServerName tai ServerAlias -osumia ei löydy, palautetaan ensimmäinen hakua vastaava virtuaalipalvelin

  Lähde: Name-based Virtual Host Support - Apache HTTP Server Version 2.4. Luettavissa: https://httpd.apache.org/docs/2.4/vhosts/name-based.html

## a) Domain-nimi

 - Olin jo hankkinut edelliselle palvelimelleni nimen. En halunnut loihtia raporttia ulkomuistista ja ajattelin toiston olevan hyvää lisäharjoitusta, joten tilasin uuden Linoden Nanode-palvelimen ja tein tehtävät siellä.
 - Aloitin luomalla palvelimen, asentamalla ja konfiguroimalla palomuurin ja Apachen. ````sudo apt-get update | sudo apt-get install ufw apache2 -y````
   - Portin 22 avaus SSH:ta varten: ````sudo ufw allow 22/tcp````
   - Portti 80 avaus HTTP:tä varten:  ````sudo ufw allow 80/tcp````
   - Palomuuri päälle: ````sudo ufw enable````
   - Käyttäjien kotisivut Apachelle: ````sudo a2enmod userdir | sudo systemctl restart apache2````
 - Loin itselleni uuden sudo-käyttäjän ````sudo adduser aatu | sudo adduser aatu sudo | sudo adduser aatu adm````, testasin tunnuksen toiminnan ja poistin root-tunnuksen käytöstä ````sudo usermod --lock root | sudoedit /etc/ssh/sshd_config # -> PermitRootLogin no````
 - Tein alkeellisen etusivun /var/www/html/index.html
 - Minulla oli tunnukset namecheap.comiin, joten tilasin uudellekin palvelimelle nimen sieltä
 - Ajattelin käyttää palvelinta lähinnä omaksi ilokseni erilaiseen testailuun. Etsin namecheapista testausnurkka-nimisiä domaineja ja valitsin edullisimman: testausnurkka.xyz. Makselin parin euron vuosimaksut PayPalilla ja avasin Namecheapin dashboardin, josta näin vuokraamani nimet.
 - Tuotelistauksesta painoin testausnurkka.xyz-sarakkeesta "manage" ja siellä siirryin Advanced DNS -välilehdelle.
 - Lisäsin Host records -osioon uuden rivin painamalla "add new record" ja lisäsin kuvan mukaiset rivit.
![Add file: dns-asetukset](/img/dns_asetukset.png)
 - Alkuun sivua ei löytynyt, sillä tiedon päivittyminen dns-palvelimille voi kestää hetken. Muutaman minuutin jälkeen sivu kuitenkin toimi osoitteella testausnurkka.xyz.
![Add file: toimii!](/img/testausnurkka_toimii.png)
