# h4 - Maailma kuulee

## x) Tiivistelmä

- Virtuaalipalvelimet (Virtual Private Server / VPS)
- Virtuaalipalvelimen käyttöönoton vaiheet:
  - Vuokraa virtuaalipalvelin valitsemaltasi toimittajalta, esim. Linodelta
    - Githubin opiskelijalisenssillä on mahdollista saada virtuaalipalvelin ja nimipalvelu rajoitetuksi ajaksi veloituksetta
  - Käytä vahvoja salasanoja kaikissa työvaiheissa
  - Ota root-tunnuksilla SSH-yhteys vuokraamaasi palvelimeen: ````ssh root@ip-osoite````
  - Asenna ja ota käyttöön palomuuri:
    ````
    sudo apt-get install ufw -y # Asenna palomuuri
    sudo ufw allow 22/tcp # Avaa portti TCP-protokollan portti 22 SSH-yhteyttä varten
    sudo ufw enable # Kytke palomuuri päälle
    ````
  - Poista root-tunnus käytöstä luomalla ensin toinen käyttäjä sudo-oikeuksilla
    ````
    sudo adduser nimi
    sudo adduser nimi sudo
    sudo adduser nimi adm
    sudo adduser nimi admin # testaa tässä vaiheessa tunnusten toimivuus ottamalla uusilla tunnuksilla ssh-yhteys
    sudo usermod --lock root # rootin salasanan lukitseminen
    sudoedit /etc/ssh/sshd_config
    # ...
    PermitRootLogin no
    # ...
    $ sudo service ssh restart
    ````
  - Päivitä paketinhallinnan listat ja asennetut sovellukset:
    ````
    sudo apt-get update
    sudo apt-get upgrade
    ````
  - Asenna haluamasi ohjelmat ja palvelut. Muista avata tarvittavat portit palomuurista.
  - Tilaa nimipalvelu (Public DNS)
    - Nimellä kätevämpi yhdistää kuin IP-osoitteella (x.x.x.x vs. exampleserver.com)

## a) Virtuaalipalvelimen vuokraus
 - Vuokrasin palvelimen Linodelta, sillä luennolla läpi käyty tilausprosessi vaikutti simppeliltä ja 5€/kk hinta ei päätä huimannut
 - Aloitin prosessin luomalla Linodelle tunnukset. Vahvan salasanan valinnassa käytin salasananhallintaohjelmistoa.
 - Painoin Create Linode ja tein seuraavat valinnat palvelimelle:
   - Distribution: Debian 12
   - Region: Frankfurt, DE (eu-central). En todennäköisesti tavoittele palvelimella Euroopan ulkopuolista käyttäjäkuntaa, joten tämä vaikutti järkevältä vaihtoehdolta.
   - Shared CPU -listauksen alta plan: Nanone 1GB
    - Palvelimen käyttöaste on hyvinkin kevyt, joten jaetusta prosessori jaetusta kapasiteetista riittää
    - 1Gt RAM-muistia kuulemma riittää hyvin, joten otin sen. Lisääminen on kuitenkin tarvittaessa helppoa.
 - Palvelimen nimi: debian-lelu
 - Rootin salasanan valitsin itse. Pyrin keksimään mahdollisimman pitkän, mutta muistettavan salasanan
  ![Add file: linode_valinnat](/img/linode_asetukset.png)
 - Löin tilauksen läpi, odottelin hetken ja palvelin oli noin minuutin odottelun jälkeen käytettävissä
  ![Add file: linode_online](/img/linode_online.png)

## b) Virtuaalipalvelimen alkutoimet
- Yhdistin palvelimeen SSH:lla MacBookin terminaalin kautta komennolla ````ssh root@143.42.197.121````
  - Yhdistäessä ensimmäistä kertaa tulostui terminaaliin varoitus siitä, ettei palvelimen aitoutta voida varmistaa, ja kysymyksen haluanko yhdistää siitä huolimatta. Muistin nähneeni saman ilmoituksen luennon esimerkkitilauksessa, joten vaikka en täysin ymmärtänytkään tämän merkitystä, jatkoin yhdistämistä.
![Add file: linode_fingerprint](/img/linode_fingerprint.png)
- Tämän jälkeen syötin rootin salasanan sitä kysyttäessä ja pääsin sisään palvelimelle
- Aloitin päivittämällä paketinhallinnan listat ja asentamalla Apachen ja palomuurin:
  ````
  sudo apt-get update
  sudo apt-get install ufw apache2 -y
  ````
- Avasin SSH-yhteyden käyttämän portin 22/TCP, että yhteys säilyisi palomuurin päälle kytkemisenkin jälkeen. Tämän jälkeen kytkin palomuurin päälle.
  ````
  sudo ufw allow 22/tcp
  sudo ufw enable # kyseli olenko varma --> y
  ````
- Tämän jälkeen avasin HTTP:lle portin 80/TCP: ````sudo ufw allow 80/tcp````
- Testasin, onnistuiko HTTP:n porttiavaus siirtymällä selaimella palvelimen osoitteeseen. Apachen esimerkkisivu avautui, joten yhteys toimi.
![Add file: linode_apache](/img/linode_apache.png)
- En ehtinyt jatkaa tässä vaiheessa puuhastelua, joten päätin jättää palvelimen näillä asetuksilla keräämään lokitietoa myöhemmin analysoitavaksi.
  - Selailin lokeja satunnaisesti puhelimen ssh-yhteyden kautta ja huomasin, että palvelimen aikavyöhyke oli UTC (+0000). Korjaan sen alkuasetusten loppuvaiheessa.

- Seuraavan päivän iltana jatkoin alkutoimia luomalla uuden käyttäjän sudo-oikeuksilla:
  ````
  sudo adduser aatu
  sudo adduser aatu sudo
  sudo adduser aatu adm
  sudo adduser aatu admin # virheilmoitus, "the group 'admin' does not exist."
  ````
  ![Add file: uusi käyttäjä](/img/linode_adduser.png)
- Suljin SSH-yhteyden ja testasin uusien tunnuksien toiminnan:
  ````
  logout
  ssh aatu@143.42.197.121 # kysyy salasanaa. Uusi salasana toimii ja kirjautuminen onnistuu
  ````
  ![Add file: ssh aatu](/img/linode_aatuconnect.png)
- Poistin vielä root-tunnukset käytöstä Teron artikkelin ohjeiden mukaisesti:
  ````
  sudo usermod --lock root
  sudoedit /etc/ssh/sshd_config
  # ...
  PermitRootLogin no
  # ...
  sudo service ssh restart
  ````
- Testasin, voiko root-tunnuksilla enää kirjautua:
  ````
  logout
  ssh root@143.42.197.121 # salasanan syöttämisen jälkeen ilmoitus: Permission denied, please try again.
  ````
  ![Add file: root denied](/img/linode_root_denied.png)
- Kirjauduin takaisin aiemmin luomalleni tunnukselle ja vaihdoin palvelimen aikavyöhykkeen Helsingin aikaan. Tämä hoitui ulkomuistista, koska olin saman prosessin tehnyt jo viime viikon tehtäviä varten pystyttämälleni palvelimelle: ````sudo timedatectl set-timezone Europe/Helsinki````
- Tarkistin palvelimen kellonajan ja päivämäärän: ````timedatectl````
  ![Add file: set TZ](/img/linode_set-tz.png)
- Uudelleenkäynnistin Apachen päivittääkseni uuden aikavyöhykkeen myös sinne: ````sudo service apache2 restart````
- Tarkistin Apachen access.log-tiedoston aikaleimat: ````tail /var/log/apache2/access.log````
  ![Add file: set TZ](/img/linode_accesslog_tz.png)
- Aikavyöhyke muuttunut 0000 --> +0300, joten päivitys onnistui.





    










