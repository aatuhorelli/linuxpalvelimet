# H3 - Hello web server

## x)


## Johdanto

Viikon Linux-tehtävät tehty testimielessä jälleen MacBookilla. Ehdin tutkiskella Apachea jo ennakkoon pöytäkoneella, joten raporttia varten päätin aloittaa puhtaalta pöydältä. Aiemmin Macille asentamani Debian toimi emuloituna niin hitaasti, että poistin sen ja asensin uudelle virtuaalikoneelle ARM-arkkitehtuuria tukevan Ubuntu Serverin (22.04.3 LTS). Oletan graafisen käyttöliittymän puuttumisen ja isäntälaitteen prosessoria tukevan käyttöjärjestelmän nopeuttavan Linuxia merkittävästi. 

### Isäntälaitteen tiedot:
    MacBook Pro M1 Pro (2021)
    Prosessori: M1 Pro (8-core)
    RAM: 16Gt
    SSD: 512Gt
    OS: MacOS Sonoma 14.0
    
## a) Apachen asennus

 - Aloitin varmistamalla lataavani pakettien tuoreimpia versioita komennolla ```sudo apt-get update```
 - Muistin tunnilta ladattavan paketin olevan nimeltään Apache2. Latasin ja asensin tämän komennolla ```sudo apt-get install apache2 -y```
 - Ubuntu tervehti asennuksessa varoituksella "Daemons using outdated libraries". Päätin selvittää vasta myöhemmin koituuko tästä ongelmia, ja painoin OK. ![Add item: outdated](img/ubuntu_outdated.png)
 - Testasin, käynnistyikö Apache itsestään, vai tulisiko se tehdä itse. ```curl localhost | less``` Sivu vastasi pyyntöön ja palautti sivun lähdekoodin. ![Add item: curl](img/ubuntu_curl.png)

## b) Apache lokianalyysi
 - Ensimmäisenä piti löytää Apachen lokitiedosto. Käytin tähän juurikansiossa komentoa ```sudo find | grep apache2 | less```. Selasin hakutulokset läpi ja polku /var/log/apache2 vaikutti lupaavalta, joten siirryin sinne ja tarkistin vielä kansion sisällön:
   ```
   cd /var/log/apache2
   ls
   ```
 - Kansiosta löytyi kolme tiedostoa, jotka tarkastin läpi ```tail [tiedostonimi]```
     - access.log ja error.log -tiedostoissa oli rivejä, other_vhosts_access.logissa ei.
     - Lokitiedostoja tarkastellessa huomasin järjestelmän kellonajan olevan 3 tuntia jäljessä. Aikavyöhyke oletettavasti väärä, koska aikaleimat näyttävät aikavyöhykkeeksi +0000. Päätin korjata tämänkin myöhemmin.
 - Avasin lokin muodostumista tarkastellakseni edellisen viikon tehtävistä tutun tmux-sovelluksen, jolla saan jaettua yhden terminaali-ikkunan useammaksi komennolla ```tmux```
   - Jaion ikkunan ensin sivusuunnassa kahteen osaan pikanäppäimiä käyttäen: ctrl + b -->  & (shift + 6)
   - Toisen ikkunan jako pystysuunnassa: ctrl + b --> " (shift + 2)
   - Avasin access- ja error.logien seurannan omiin ikkunoihinsa ja kolmatta ikkunaa käytin sivun kutsumiseen
    ```
    tail -f access.log
    tail -f error.log
    curl localhost
    ```
    ![Add file: tmux](img/ubuntu_tmux.png)
   - Lokitiedostojen tulkitsemisen apuna käytin epäselvissä kohdissa Apachen omaa dokumentaatiota
   - Access.log merkintä sivulatauksesta:
     ```
     127.0.0.1 - - [10/Sep/2023:19:03:27 +0000] "GET / HTTP/1.1" 200 19026 "-" curl/7.81.0"
     ```
       - 127.0.0.1 - Pyynnön lähettäjän(client) ip-osoite 
       - "-" tarkoittaa, että tietoa ei saatavilla.
         - Ensimmäisen "-" kohdalle ilmeisesti kirjataan clientin RFC 1413 identiteetti, jos tämä on saatavilla. Apache pyrkii hakemaan tämän ainoastaan, jos IdentityCheck on kytketty päälle.
         - Toisen "-" kohdalle kirjataan pyynnön lähettäjän käyttäjätunnus, jos kyseessä on HTTP tunnistautumista vaativa dokumentti. Apachen testisivu on avoin, joten tässä kenttä tyhjä.
    - [10/Sep/2023:19:03:27 +0000] - Palvelimen kellonaika lokimerkinnän muodostuessa. 10. syyskuuta 2023 kello 19:03:27, UTC-aikavyöhyke.
    - "GET / HTTP/1.1" - Clientin lähettämä pyyntö. GET = metodi, / = pyydetty sivu, HTTP/1.1 = käytetty protokolla. Client pyytää siis ilmeisesti lähettämään http://127.0.0.1/ sivun HTTP 1.1 protokollaa käyttäen.
    - 200 - Palvelimen palauttama statuskoodi. Apachen dokumentaation mukaan 2xx-alkuiset vastaukset viittaavat onnistuneeseen kutsuun. Kutsu on vastaanotettu, ymmärretty ja hyväksytty. 200 = OK
    - 10926 - Clientille palautetun objektin koko tavuina, ~11kt. 

Lähde: Apache HTTP Server - Log files: https://httpd.apache.org/docs/2.4/logs.html
   
